'use strict';

/* Function: read_a_temp
 * This function occurs after a route calls this specific routine
 * with a get function in order to retrieve temperature for a certain
 * zip code
 *
 * params: zip, ?scale
 * return: json message
 */
exports.read_a_temp = function(req, res) {
	  let request = require('request');

	  let apiKey = '31d05241c8003174b3d2d5df6ab6a5a4'; //My API KEY
	  let zip = req.params.zipcode; //zip code user wants weather for
	  let un = req.query.scale; //Scale user wants response in
	  let url='';
	  if(un == 'Celsius') //Checks if Query is Celsius
		url= `http://api.openweathermap.org/data/2.5/weather?zip=${zip}&units=metric&appid=${apiKey}`
	  else{ //if not then force Fahrenheit even for those that made spelling errors or trying to trick system
		url= `http://api.openweathermap.org/data/2.5/weather?zip=${zip}&units=imperial&appid=${apiKey}`
	    un= 'Fahrenheit';} //force change scale

      request(url, function (err, response, body) {
      if(err){
        console.log('error:', error);
      } else {
        let weather = JSON.parse(body)
        let message = `{ "temperature": ${weather.main.temp}, "scale":"${un}"}`; //format json
		let obj = JSON.parse(message);
        console.log(message); //command line testing
		res.json(obj); //send json
      }
      });
	};
	
